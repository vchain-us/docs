<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>kube-notary | CodeNotary Documentation</title>
    <meta name="description" content=" ">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.dcd73214.css" as="style"><link rel="preload" href="/assets/js/app.bd528582.js" as="script"><link rel="preload" href="/assets/js/2.3aa6498e.js" as="script"><link rel="preload" href="/assets/js/17.1eab99be.js" as="script"><link rel="prefetch" href="/assets/js/10.0bf4b7f5.js"><link rel="prefetch" href="/assets/js/11.e58ee0e2.js"><link rel="prefetch" href="/assets/js/12.9b0da8aa.js"><link rel="prefetch" href="/assets/js/13.921a2a3c.js"><link rel="prefetch" href="/assets/js/14.06192861.js"><link rel="prefetch" href="/assets/js/15.12d97975.js"><link rel="prefetch" href="/assets/js/16.117205aa.js"><link rel="prefetch" href="/assets/js/18.98d0f178.js"><link rel="prefetch" href="/assets/js/19.9b3503c1.js"><link rel="prefetch" href="/assets/js/20.7dce90d7.js"><link rel="prefetch" href="/assets/js/21.a9ef71d6.js"><link rel="prefetch" href="/assets/js/22.9a9567b5.js"><link rel="prefetch" href="/assets/js/23.52b0c706.js"><link rel="prefetch" href="/assets/js/24.58ad025f.js"><link rel="prefetch" href="/assets/js/25.8b259d3a.js"><link rel="prefetch" href="/assets/js/26.950e239c.js"><link rel="prefetch" href="/assets/js/27.b8998c80.js"><link rel="prefetch" href="/assets/js/28.408962c3.js"><link rel="prefetch" href="/assets/js/29.094e7edd.js"><link rel="prefetch" href="/assets/js/3.a9e4ddfb.js"><link rel="prefetch" href="/assets/js/30.d3fecd33.js"><link rel="prefetch" href="/assets/js/31.d027554c.js"><link rel="prefetch" href="/assets/js/32.7952f79c.js"><link rel="prefetch" href="/assets/js/33.777d68eb.js"><link rel="prefetch" href="/assets/js/34.e8a87778.js"><link rel="prefetch" href="/assets/js/35.7a1d0aaa.js"><link rel="prefetch" href="/assets/js/36.841ccd4d.js"><link rel="prefetch" href="/assets/js/37.5af7cbc5.js"><link rel="prefetch" href="/assets/js/38.b0170d64.js"><link rel="prefetch" href="/assets/js/39.6c837eae.js"><link rel="prefetch" href="/assets/js/4.3b34ced6.js"><link rel="prefetch" href="/assets/js/40.489c617d.js"><link rel="prefetch" href="/assets/js/41.74250271.js"><link rel="prefetch" href="/assets/js/42.e76ec115.js"><link rel="prefetch" href="/assets/js/43.8f418578.js"><link rel="prefetch" href="/assets/js/44.8ca2acba.js"><link rel="prefetch" href="/assets/js/45.3ee52b20.js"><link rel="prefetch" href="/assets/js/5.557818ca.js"><link rel="prefetch" href="/assets/js/6.6be52fbe.js"><link rel="prefetch" href="/assets/js/7.67ab1151.js"><link rel="prefetch" href="/assets/js/8.a434a011.js"><link rel="prefetch" href="/assets/js/9.1bb454cb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dcd73214.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/codenotary-mascot.png" alt="CodeNotary Documentation" class="logo"> <span class="site-name can-hide">CodeNotary Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.codenotary.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Website
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/vchain-us" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.codenotary.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Website
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/vchain-us" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Get started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/quickhelp.html" class="sidebar-link">Quickstart Help Guide</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/dashboard/" class="sidebar-heading clickable"><span>Dashboard</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vcn CLI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Integrations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/integrations/vcn-docker.html" class="sidebar-link">Docker Integration for vcn</a></li><li><a href="/integrations/kube-notary.html" class="active sidebar-link">kube-notary</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/integrations/kube-notary.html#how-it-works" class="sidebar-link">How it works</a></li><li class="sidebar-sub-header"><a href="/integrations/kube-notary.html#install" class="sidebar-link">Install</a></li><li class="sidebar-sub-header"><a href="/integrations/kube-notary.html#uninstall" class="sidebar-link">Uninstall</a></li><li class="sidebar-sub-header"><a href="/integrations/kube-notary.html#usage" class="sidebar-link">Usage</a></li><li class="sidebar-sub-header"><a href="/integrations/kube-notary.html#configuration" class="sidebar-link">Configuration</a></li><li class="sidebar-sub-header"><a href="/integrations/kube-notary.html#faq" class="sidebar-link">FAQ</a></li><li class="sidebar-sub-header"><a href="/integrations/kube-notary.html#testing" class="sidebar-link">Testing</a></li><li class="sidebar-sub-header"><a href="/integrations/kube-notary.html#license" class="sidebar-link">License</a></li></ul></li><li><a href="/integrations/jsvcn.html" class="sidebar-link">jsvcn</a></li><li><a href="/integrations/jvcn.html" class="sidebar-link">JVCN</a></li><li><a href="/integrations/jvcn-maven-plugin.html" class="sidebar-link">JVCN Maven Plugin</a></li><li><a href="/integrations/verify-commit-action.html" class="sidebar-link">Verify commit GitHub action</a></li><li><a href="/integrations/vcn-jenkins.html" class="sidebar-link">Jenkins Integration for vcn</a></li><li><a href="/integrations/vcn-powershell.html" class="sidebar-link">vcn-powershell</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kube-notary"><a href="#kube-notary" class="header-anchor">#</a> kube-notary</h1> <blockquote><p>A Kubernetes watchdog for verifying image trust with CodeNotary.</p></blockquote> <p><img src="https://raw.githubusercontent.com/vchain-us/kube-notary/master/docs/images/info.png" alt="alt text" title="CodeNotary for Kubernetes"></p> <h2 id="how-it-works"><a href="#how-it-works" class="header-anchor">#</a> How it works</h2> <p><strong>kube-notary</strong> is a monitoring tool for <em>Continuous Verification</em> (CV) via <a href="https://codenotary.io" target="_blank" rel="noopener noreferrer">CodeNotary<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
The idea behind CV is to continuously monitor your cluster at runtime and be notified when unknown or untrusted container images are running.</p> <p>Once <code>kube-notary</code> is installed within your cluster, all pods are checked every minute (interval and other settings can be <a href="#Configuration">configured</a>).
For each of the running containers in each pod, <code>kube-notary</code> resolves the <code>ImageID</code> of the container's image to the actual image's hash and finally looks up the <a href="https://github.com/vchain-us/vcn/blob/master/docs/user-guide/signatures.md#signatures" target="_blank" rel="noopener noreferrer">hash's signature in the CodeNotary's blockchain<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Furthermore, kube-notary provides a built-in exporter for sending verification <a href="#Metrics">metrics</a> to Prometheus, which can then that can be easily visualized with the provided <a href="grafana">grafana dashboard</a>.</p> <p>Images you trust can be signed by using the CodeNotary <a href="https://github.com/vchain-us/vcn" target="_blank" rel="noopener noreferrer">vcn<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> CLI tool.</p> <p>https://infograph.venngage.com/ps/ex4ECrROPCQ/codenotary-for-kubernetes</p> <h2 id="install"><a href="#install" class="header-anchor">#</a> Install</h2> <p><code>kube-notary</code> is installed using a Helm chart.</p> <blockquote><p>Kubernetes 1.9 or above, and Helm 2.8 or above need to be installed in your cluster.</p></blockquote> <p>First, make sure your local config is pointing to the context you want to use (ie. check <code>kubectl config current-context</code>).
Then, to install <code>kube-notary</code>:</p> <ul><li>Clone this repository locally: https://github.com/vchain-us/kube-notary</li> <li>Change directory into <code>kube-notary</code>.</li> <li>Finally run:</li></ul> <p>Helm v2</p> <div class="language- extra-class"><pre class="language-text"><code>helm install -n kube-notary helm/kube-notary
</code></pre></div><p>Helm v3</p> <div class="language- extra-class"><pre class="language-text"><code>helm install kube-notary helm/kube-notary -n kube-notary
</code></pre></div><blockquote><p>See the <a href="#Configuration">Configuration</a> paragraph for detailed instructions.</p></blockquote> <h3 id="namespaced"><a href="#namespaced" class="header-anchor">#</a> Namespaced</h3> <p>If you do not have cluster-wide access, you can still install <code>kube-notary</code> within a single namespace, using:</p> <div class="language- extra-class"><pre class="language-text"><code>helm install -n kube-notary helm/kube-notary --set watch.namespace=&quot;default&quot;
</code></pre></div><p>When so configured, a namespaced <code>Role</code> will be created instead of the default <code>ClusterRole</code> to accommodate Kubernetes <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank" rel="noopener noreferrer">RBAC<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for a single namespace. <code>kube-notary</code> will get permission for, and will watch, the configured namespace only.</p> <h3 id="manual-installation-without-helm"><a href="#manual-installation-without-helm" class="header-anchor">#</a> Manual installation (without Helm)</h3> <p>Alternatively, it is possible to manually install <code>kube-notary</code> without using Helm. Instructions and templates for manual installation are within the <a href="kubernetes">kubernetes folder</a>.</p> <h2 id="uninstall"><a href="#uninstall" class="header-anchor">#</a> Uninstall</h2> <p>You can uninstall <code>kube-notary</code> at any time using:</p> <div class="language- extra-class"><pre class="language-text"><code>helm delete --purge kube-notary
</code></pre></div><h2 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h2> <p><code>kube-notary</code> provides both detailed log output and a Prometheus metrics endpoint to monitor the verification status of your running containers. After the installation you will find instructions on how to get them.</p> <p>Examples:</p> <div class="language- extra-class"><pre class="language-text"><code>  # Metrics endpoint
  export SERVICE_NAME=service/$(kubectl get service --namespace default -l &quot;app.kubernetes.io/name=kube-notary,app.kubernetes.io/instance=kube-notary&quot; -o jsonpath=&quot;{.items[0].metadata.name}&quot;)
  echo &quot;Check the metrics endpoint at http://127.0.0.1:9581/metrics&quot;
  kubectl port-forward --namespace default $SERVICE_NAME 9581

  # Results endpoint
  export SERVICE_NAME=service/$(kubectl get service --namespace default -l &quot;app.kubernetes.io/name=kube-notary,app.kubernetes.io/instance=kube-notary&quot; -o jsonpath=&quot;{.items[0].metadata.name}&quot;)
  echo &quot;Check the verification results endpoint at http://127.0.0.1:9581/results&quot;
  kubectl port-forward --namespace default $SERVICE_NAME 9581

  # Stream logs
  export POD_NAME=$(kubectl get pods --namespace default -l &quot;app.kubernetes.io/name=kube-notary,app.kubernetes.io/instance=kube-notary&quot; -o jsonpath=&quot;{.items[0].metadata.name}&quot;)
  kubectl logs --namespace default -f $POD_NAME

  # Bulk sign all running images
  export POD_NAME=$(kubectl get pods --namespace default -l &quot;app.kubernetes.io/name=kube-notary,app.kubernetes.io/instance=kube-notary&quot; -o jsonpath=&quot;{.items[0].metadata.name}&quot;)
  kubectl exec --namespace default -t $POD_NAME sh /bin/bulk_sign &gt; vcn_bulk_sign.sh
  chmod +x vcn_bulk_sign.sh &amp;&amp; ./vcn_bulk_sign.sh
</code></pre></div><h3 id="status-page"><a href="#status-page" class="header-anchor">#</a> Status page</h3> <p><code>kube-notary</code> provides an embedded status page with details of running containers and verifications. Once <code>kube-notary</code> is up and running the page is available at <code>http://$SERVICE_ADDRESS:9581/status/</code> (the service address depends on your installation). If you installed it by using the provided helm chart, the easiest way to get the status page URL is:</p> <div class="language- extra-class"><pre class="language-text"><code>  # Status page
  export SERVICE_NAME=service/$(kubectl get service --namespace default -l &quot;app.kubernetes.io/name=kube-notary,app.kubernetes.io/instance=kube-notary&quot; -o jsonpath=&quot;{.items[0].metadata.name}&quot;)
  echo &quot;Status page at http://127.0.0.1:9581/status/&quot;
  kubectl port-forward --namespace default $SERVICE_NAME 9581
</code></pre></div><h3 id="metrics"><a href="#metrics" class="header-anchor">#</a> Metrics</h3> <p>If a Prometheus installation is running within your cluster, metrics provided by <code>kube-notary</code> will be automatically discovered.
Furthermore, you can find an example of a preconfigured Grafana dashboard <a href="/integrations/grafana/">here</a>.</p> <h2 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h2> <p>By default, <code>kube-notary</code> is installed into the current namespace (you can change it by using <code>helm install --namespace</code>) but it will watch to pods in all namespaces.</p> <p>At install time you can change any values of <a href="helm/kube-notary/values.yaml">helm/kube-notary/values.yaml</a> by using the Helm's <code>--set</code> option.
For example, to instruct <code>kube-notary</code> to check only the <code>kube-system</code> namespace, just use:</p> <div class="language- extra-class"><pre class="language-text"><code>helm install -n kube-notary helm/kube-notary --set watch.namespace=&quot;kube-system&quot;
</code></pre></div><h3 id="trusted-signers"><a href="#trusted-signers" class="header-anchor">#</a> Trusted signers</h3> <p>Choosing signers who can be trusted is easy. At install time, you can <code>--set</code> one of the following options.</p> <h4 id="configure-a-list-of-trusted-keys"><a href="#configure-a-list-of-trusted-keys" class="header-anchor">#</a> Configure a list of trusted keys</h4> <p>Lists can be expressed by enclosing keys in <code>{</code> and <code>}</code> separated by <code>,</code>. For example:</p> <div class="language- extra-class"><pre class="language-text"><code>helm install -n kube-notary helm/kube-notary --set &quot;trust.keys={0x123..., 0x123...}&quot;
</code></pre></div><h4 id="configure-a-trusted-organization"><a href="#configure-a-trusted-organization" class="header-anchor">#</a> Configure a trusted organization</h4> <div class="language- extra-class"><pre class="language-text"><code>helm install -n kube-notary helm/kube-notary --set &quot;trust.org=your.organization.com&quot;
</code></pre></div><h4 id="note"><a href="#note" class="header-anchor">#</a> Note</h4> <p>If both <code>trust.org</code> and <code>trust.keys</code> are set, only <code>trust.org</code> will be used.</p> <p>If none is set, the last <a href="https://github.com/vchain-us/vcn/blob/master/docs/user-guide/signatures.md#signatures" target="_blank" rel="noopener noreferrer">signature<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> by the signer with the highest available <a href="https://github.com/vchain-us/vcn/blob/master/docs/user-guide/signatures.md#level" target="_blank" rel="noopener noreferrer">level<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> will be used during the verification.</p> <h3 id="runtime-configuration"><a href="#runtime-configuration" class="header-anchor">#</a> Runtime configuration</h3> <p>The following options within <a href="helm/kube-notary/values.yaml">helm/kube-notary/values.yaml</a> have effect on the <code>kube-notary</code> runtime behavior.</p> <div class="language- extra-class"><pre class="language-text"><code># Runtime config
log:
  level: info # verbosity level, one of: trace, debug, info, warn, error, fatal, panic
watch: 
  namespace: &quot;&quot; # the namespace name to watch 
  interval: 60s # duration of the watching interval
trust:
  org: &quot;&quot; # ID of the trusted organization, if not empty `keys` above will be ignored
  keys: # array of signing keys to verify against
   - ...
   - ...
</code></pre></div><p>During the installation, they are stored in a <code>configmap</code>. Configuration hot-reloading is supported, so you can modify and apply the configmap while <code>kube-notary</code> is running.</p> <p>For example, to change the watching interval from default to <code>30s</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl patch configmaps/kube-notary \
    --type merge \
    -p '{&quot;data&quot;:{&quot;config.yaml&quot;:&quot;log:\n  level: debug\nwatch: \n  namespace: \n  interval: 30s&quot;}}'
</code></pre></div><h2 id="faq"><a href="#faq" class="header-anchor">#</a> FAQ</h2> <h3 id="why-continuous-verification"><a href="#why-continuous-verification" class="header-anchor">#</a> Why <em>Continuous Verification</em> ?</h3> <p>Things change over time. Suppose you signed an image because you trust it. Later, you find a security issue within the image or you just want to deprecate that version. When that happens you can simply use <a href="https://github.com/vchain-us/vcn#basic-usage" target="_blank" rel="noopener noreferrer">vcn<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to <a href="https://github.com/vchain-us/vcn/blob/master/docs/user-guide/signatures.md#statuses" target="_blank" rel="noopener noreferrer">untrust or unsupport<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> that image version. Once the image is not trusted anymore,
thanks to <code>kube-notary</code> you can easily discover if the image is still running somewhere in your cluster.</p> <p>In general, verifying an image just before its execution is not enough because the image's status or the image that's used by a container can change over time. <em>Continuous Verification</em> ensures that you will always get noticed if an unwanted behavior occurs.</p> <h3 id="how-can-i-sign-my-image"><a href="#how-can-i-sign-my-image" class="header-anchor">#</a> How can I sign my image?</h3> <p>You can easily sign your container's images by using the <a href="https://github.com/vchain-us/vcn" target="_blank" rel="noopener noreferrer">vcn CLI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> we provide separately.</p> <p><code>vcn</code> supports local Docker installations out of the box using <code>docker://</code> prefix, followed by the image name or image reference.
You just have to pull the image you want to sign, then finally run <code>vcn sign</code>. Detailed instructions can be found <a href="https://github.com/vchain-us/vcn/blob/master/docs/user-guide/schemes/docker.md" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Furthermore, if you want to bulk sign all images running inside your cluster, you will find below instructions to generate a script that automates the process.</p> <p>Export <code>POD_NAME</code> setting it to the <code>kube-notary</code>'s pod name, then run:</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl exec --namespace default -t $POD_NAME sh /bin/bulk_sign &gt; vcn_bulk_sign.sh
chmod +x vcn_bulk_sign.sh &amp;&amp; ./vcn_bulk_sign.sh
</code></pre></div><blockquote><p>Note that a <a href="https://codenotary.io" target="_blank" rel="noopener noreferrer">CodeNotary<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> account and a local installation of <a href="https://github.com/vchain-us/vcn" target="_blank" rel="noopener noreferrer">vcn<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> are needed.
Also, make sure your <code>kubectl</code> is pointing to the context you want to use.</p></blockquote> <h3 id="how-can-i-be-notified-when-untrusted-images-are-runnig"><a href="#how-can-i-be-notified-when-untrusted-images-are-runnig" class="header-anchor">#</a> How can I be notified when untrusted images are runnig?</h3> <p>First, Prometheus and Grafana need to be installed in your cluster.</p> <p>Then it's easy to <a href="grafana#creating-alerts">create alerts</a> using the provided <a href="grafana">Grafana dashboard</a></p> <h3 id="why-my-image-cannot-be-signed-manifest-v2-schema-1"><a href="#why-my-image-cannot-be-signed-manifest-v2-schema-1" class="header-anchor">#</a> Why my image cannot be signed? (manifest v2 schema 1)</h3> <p>The image manifest v2 schema 1 format is <a href="https://docs.docker.com/engine/deprecated/#pushing-and-pulling-with-image-manifest-v2-schema-1" target="_blank" rel="noopener noreferrer">deprecated<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in favor of the v2 schema 2 format.</p> <p>Please, move to v2 schema 2 as soon as possible. Usually, you can fix that simply by pushing your image again on the registry.</p> <h3 id="cannot-create-resource-clusterrolebindings"><a href="#cannot-create-resource-clusterrolebindings" class="header-anchor">#</a> Cannot create resource &quot;clusterrolebindings&quot;</h3> <p>Recent versions of Kubernetes employ a <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank" rel="noopener noreferrer">role-based access control<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (or RBAC) system to drive authorization decisions. It might be possible that your account does not have enough privileges to create the <code>ClusterRole</code> needed to get cluster-wide access.</p> <p>Please use a high privileged account to install <code>kube-notary</code>. Alternatively, if you don't have cluster-wide access, you can still install <code>kube-notary</code> to work in a single namespace which you can access. See the <a href="#Namespaced">namespaced installation</a> paragraph for further details.</p> <h3 id="helm-error-release-kube-watch-failed-namespaces-is-forbidden"><a href="#helm-error-release-kube-watch-failed-namespaces-is-forbidden" class="header-anchor">#</a> Helm error: release kube-watch failed: namespaces &quot;...&quot; is forbidden</h3> <p>It might be possible that <code>tiller</code> (the Helm's server-side component) does not have permission to install <code>kube-notary</code>.</p> <p>When working within a <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank" rel="noopener noreferrer">role-based access control<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> enabled Kubernetes installation, you may need to add a <a href="https://helm.sh/docs/using_helm/#tiller-and-role-based-access-control" target="_blank" rel="noopener noreferrer">service account with cluster-admin role<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for <code>tiller</code>.</p> <p>The easier way to do that is just to create a <code>rbac-config.yaml</code> copying and pasting the <a href="https://helm.sh/docs/using_helm/#example-service-account-with-cluster-admin-role" target="_blank" rel="noopener noreferrer">provided example in the Helm documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, then:</p> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl create -f rbac-config.yaml
serviceaccount &quot;tiller&quot; created
clusterrolebinding &quot;tiller&quot; created
$ helm init --service-account tiller --history-max 200
</code></pre></div><h3 id="servicemonitor-for-prometheus-operator"><a href="#servicemonitor-for-prometheus-operator" class="header-anchor">#</a> ServiceMonitor for Prometheus Operator</h3> <p>See <a href="https://github.com/vchain-us/kube-notary/issues/11" target="_blank" rel="noopener noreferrer">#11<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="testing"><a href="#testing" class="header-anchor">#</a> Testing</h2> <div class="language- extra-class"><pre class="language-text"><code>make test/e2e
</code></pre></div><h2 id="license"><a href="#license" class="header-anchor">#</a> License</h2> <p>This software is released under <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener noreferrer">GPL3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/integrations/vcn-docker.html" class="prev">
        Docker Integration for vcn
      </a></span> <span class="next"><a href="/integrations/jsvcn.html">
        jsvcn
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bd528582.js" defer></script><script src="/assets/js/2.3aa6498e.js" defer></script><script src="/assets/js/17.1eab99be.js" defer></script>
  </body>
</html>
